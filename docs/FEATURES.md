# Функции приложения

## Реализованные функции (v0.1 MVP)

### 1. BLE сканирование и подключение

**Возможности:**
- Автоматическое сканирование устройств Meshtastic по UUID сервиса
- Отображение списка найденных устройств с именем и MAC-адресом
- Выбор устройства для подключения
- Установка GATT соединения с автоматическим MTU negotiation
- Индикация состояния подключения в реальном времени

**Технические детали:**
- UUID сервиса: `6ba1b218-15a8-461f-9fa8-5dcae273eafd`
- Таймаут сканирования: 6 секунд
- MTU: авто-согласование до 512 байт
- Переподключение: ручное (требует действия пользователя)

**Экраны:**
- `ConnectionFragment` — управление подключением

---

### 2. Мониторинг состояния устройства и сети

**Возможности:**
- Отображение текущего состояния BLE соединения
- Визуализация последних входящих данных (hex)
- Расшифровка FromRadio пакетов
- Телеметрия устройства (батарея, SNR, last heard)
- Информация о прошивке
- Timestamp последнего приёма данных

**Обновления:**
- В реальном времени через LiveData
- Автоматически при получении FromRadio

**Экраны:**
- `StatusFragment` — панель состояния

---

### 3. Список узлов сети

**Возможности:**
- Отображение всех узлов, от которых получены данные
- Информация по каждому узлу:
  - Имя (long name, short name, user ID)
  - Номер узла
  - Батарея (если доступно)
  - SNR
  - Количество хопов
  - Координаты (широта/долгота)
  - Время последнего приёма
  - Канал (если не PRIMARY)
  - Индикатор MQTT (если via MQTT)

**Обновления:**
- При получении NODE_INFO от устройства
- Кэширование в памяти (ConcurrentHashMap)

**Экраны:**
- `NodesFragment` — список узлов
- `NodesAdapter` — адаптер RecyclerView

---

### 4. Настройки канала и PSK

**Возможности:**
- Локальное сохранение черновика настроек:
  - Имя узла (node name)
  - Регион (LoRa region)
  - Имя канала
  - PSK (Pre-Shared Key)
  
- Применение настроек на устройство по BLE:
  - Имя канала (PRIMARY, index=0)
  - PSK (AES-128/256)

**Ограничения:**
- Имя узла и регион сохраняются только локально (не отправляются)
- Нет подтверждения от устройства об успешном применении
- Требуется ручная перезагрузка устройства для вступления в силу

**Хранение:**
- `SharedPreferences` (локально на телефоне)
- Данные сохраняются между сессиями

**Экраны:**
- `SettingsFragment` — конфигурация
- `SettingsStore` — хранилище

---

### 5. Визуальная и текстовая обратная связь

**Возможности:**
- Цветовая индикация состояния (зелёный/красный)
- Toast уведомления для операций
- Текстовые статусы ("Подключено", "Ошибка")
- Hex дамп входящих данных для диагностики
- Расшифрованные сообщения FromRadio

**Компоненты:**
- MaterialCardView для блоков информации
- TextView с автообновлением через LiveData
- ProgressBar для индикации длительных операций

---

### 6. Protobuf парсинг

**Поддерживаемые типы FromRadio:**
- `MY_INFO` — информация о подключённом узле
- `NODE_INFO` — информация об узлах сети
- `CONFIG` — обновления конфигурации
- `CHANNEL` — настройки каналов
- `PACKET` — mesh пакеты
- `METADATA` — метаданные устройства (версия прошивки)
- `LOG_RECORD` — логи с устройства

**Не поддерживаются (игнорируются):**
- `MODULE_CONFIG`
- `QUEUE_STATUS`
- `XMODEM_PACKET`
- `CLIENT_NOTIFICATION`

**Парсер:**
- `MeshProtoParser` — человекочитаемые сводки

---

## Ограничения текущей версии

### Функциональные ограничения

1. **Только BLE транспорт**
   - Нет поддержки Serial (USB)
   - Нет поддержки MQTT proxy
   - Нет поддержки TCP/IP

2. **Настройки**
   - Имя узла не применяется на устройство
   - Регион не применяется на устройство
   - Нет расширенных настроек (power, lora config)
   - Нет admin команд (reboot, factory reset)

3. **Протокол**
   - Нет поддержки отправки текстовых сообщений
   - Нет поддержки отправки позиции
   - Нет поддержки получения/отправки файлов (XMODEM)

4. **UI**
   - Нет карты для визуализации узлов
   - Нет чата
   - Нет истории сообщений
   - Нет offline режима

5. **Обратная связь**
   - Нет подтверждения применения настроек от устройства
   - Нет обработки ClientNotification
   - Нет индикации ошибок при отправке

---

## В разработке

### Высокий приоритет

1. **Подтверждение настроек**
   - Обработка ответа от устройства
   - Индикация успеха/ошибки применения
   - Retry логика при ошибках

2. **RSSI и MTU в статусе**
   - Отображение силы сигнала BLE
   - Текущий MTU размер
   - Connection interval

3. **Отправка текстовых сообщений**
   - Простой текстовый ввод
   - Отправка на канал
   - Отображение отправленных сообщений

4. **Reconnect автоматический**
   - При потере соединения
   - Экспоненциальный backoff
   - Уведомление пользователя

---

## Планируется (Roadmap)

### Версия 0.2 (Q2 2026)

**Чат:**
- Экран чата с историей сообщений
- Отправка/получение текстовых сообщений
- Отображение отправителя и времени
- Локальное сохранение истории (Room DB)

**Навигация:**
- Добавление вкладки "Чат" в BottomNavigation
- Уведомления о новых сообщениях

**Расширенные настройки:**
- Применение имени узла
- Применение региона (LoRa config)
- Настройка мощности передатчика

---

### Версия 0.3 (Q3 2026)

**Карта:**
- Интеграция MapLibre GL или OsmDroid
- Отображение узлов на карте
- Собственная позиция (GPS)
- Отправка позиции в сеть

**Геолокация:**
- Получение GPS координат телефона
- Автоматическая отправка позиции (опционально)
- Навигация к узлу

**UI улучшения:**
- Тёмная тема
- Адаптивность под планшеты
- Настройки приложения (частота обновлений, тема)

---

### Версия 0.4 (Q4 2026)

**Offline режим:**
- Кэширование карты для offline
- Сохранение сообщений в БД
- Работа без интернета

**Admin команды:**
- Reboot устройства
- Factory reset
- Firmware update (через XMODEM)

**Фоновый режим:**
- Foreground Service для поддержания BLE
- Уведомления о новых сообщениях в фоне
- Опция "всегда подключён"

---

### Версия 1.0 (Q1 2027)

**Полная поддержка протокола:**
- Все типы пакетов (telemetry, waypoints, audio)
- Все admin команды
- Все module configs

**Многоканальность:**
- Поддержка SECONDARY каналов
- Переключение между каналами в UI

**Группы:**
- Создание групп узлов
- Фильтрация по группам
- Групповые чаты

**Резервные копии:**
- Экспорт настроек (JSON)
- Импорт настроек
- Sync через cloud (опционально)

---

## Экспериментальные функции (не обещано)

### MQTT мост
- Подключение к MQTT серверу через телефон
- Публикация mesh сообщений в MQTT
- Получение MQTT сообщений в mesh

### Serial транспорт
- Подключение через USB OTG
- Более стабильное соединение
- Больший throughput

### P2P режим
- Прямое mesh общение между телефонами (без устройства)
- Использование Wi-Fi Direct или BLE mesh

### ИИ ассистент
- Автоматические ответы
- Анализ состояния сети
- Предложения по оптимизации

---

## Сравнение с официальным приложением

| Функция | Официальное | Этот проект |
|---------|-------------|-------------|
| BLE подключение | ✓ | ✓ |
| Serial (USB) | ✓ | ✗ |
| Чат | ✓ | Планируется |
| Карта | ✓ | Планируется |
| Список узлов | ✓ | ✓ |
| Настройки канала | ✓ | ✓ (частично) |
| Расширенные настройки | ✓ | Планируется |
| MQTT | ✓ | ✗ |
| Offline карты | ✓ | Планируется |
| Фоновый режим | ✓ | Планируется |

---

## Feedback и запросы функций

Если вам нужна конкретная функция:
1. Создайте issue в GitHub репозитории
2. Опишите use case (зачем нужна функция)
3. Предложите UI/UX (если возможно)

Приоритет функций определяется:
- Количеством запросов
- Сложностью реализации
- Совместимостью с архитектурой
